# ===== CONFIGURAÇÕES BÁSICAS =====

# Trocar prefixo para Ctrl+a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Dividir painéis
bind | split-window -h
bind - split-window -v

# Recarregar configuração
bind r source-file ~/.tmux.conf \; display "Configuração recarregada!"

# Habilitar mouse
set -g mouse on

# Numeração começando em 1
set -g base-index 1
setw -g pane-base-index 1

# ===== STATUS BAR =====
set -g status-bg black
set -g status-fg white
set -g status-left '#[fg=cyan,bold][#S]#[fg=white] '
setw -g window-status-current-format '#[fg=cyan,bold]#I:#W#[fg=white]'
setw -g window-status-format '#[fg=white]#I:#W#[fg=white]'
setw -g window-status-separator ' | '
set -g status-right '#[fg=white]%d-%m-%Y | %H:%M | #(whoami)@#h'

# ===== COMANDOS ÚTEIS =====
bind X confirm-before -p "Matar sessão #S? (y/n)" kill-session
bind R command-prompt -I "#W" "rename-window '%%'"
bind C command-prompt -p "Nome da janela:" "new-window -n '%%'"

# ===== SCRIPT EMBUTIDO =====
run-shell 'mkdir -p ~/.tmux'
run-shell 'cat > ~/.tmux/create-session.sh << "EOF"
#!/bin/bash

SESSION_NAME="peak"

# Cria sessão se não existir
if ! tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    tmux new-session -d -s "$SESSION_NAME" -n "terminal"        # primeira janela
    tmux new-window -t "$SESSION_NAME:2" -n "nvim"
    tmux new-window -t "$SESSION_NAME:3" -n "random"
fi

# Conecta na sessão peak
tmux select-window -t "$SESSION_NAME:2"   # janela nvim setada como primaria
tmux attach-session -t "$SESSION_NAME"
EOF'

run-shell 'chmod +x ~/.tmux/create-session.sh'

# ===== FUNÇÃO / ALIAS TMUXC =====
run-shell 'cat > ~/.tmux_aliases << "EOF"
tmuxc() {
    SESSION_NAME="peak"

    if ! tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
        tmux new-session -d -s "$SESSION_NAME" -n "terminal"        # primeira janela
        tmux new-window -t "$SESSION_NAME:2" -n "nvim"
        tmux new-window -t "$SESSION_NAME:3" -n "random"
    fi

    tmux select-window -t "$SESSION_NAME:2"   # janela nvim setada como primaria
    tmux attach-session -t "$SESSION_NAME"
}

# Alias tmuxc
if ! type tmuxc > /dev/null 2>&1; then
    alias tmuxc=tmuxc
fi
EOF'

# Fonte automática para bash/zsh
run-shell 'for rc in ~/.bashrc ~/.zshrc; do
    if [ -f "$rc" ] && ! grep -q "source ~/.tmux_aliases" "$rc"; then
        echo -e "\n# Carrega tmuxc\n[ -f ~/.tmux_aliases ] && source ~/.tmux_aliases" >> $rc
    fi
done'

run-shell 'echo "⚠️  Execute: source ~/.bashrc e/ou ~/.zshrc para ativar tmuxc"'
